import os
import asyncio
import logging
from enum import Enum, IntEnum, auto

from dotenv import load_dotenv

from telegram import (
    Update,
    ReplyKeyboardMarkup,
    ReplyKeyboardRemove,
    KeyboardButton,
)
from telegram.ext import (
    ApplicationBuilder,
    CommandHandler,
    MessageHandler,
    ConversationHandler,
    ContextTypes,
    PicklePersistence,
    filters,
)

# ---------- –õ–û–ì–ò–†–û–í–ê–ù–ò–ï ----------

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# ---------- –ó–ê–ì–†–£–ó–ö–ê –ù–ê–°–¢–†–û–ï–ö ----------

load_dotenv()
BOT_TOKEN = os.getenv("BOT_TOKEN")
ADMIN_CHAT_ID = int(os.getenv("ADMIN_CHAT_ID", "0") or "0")

# –°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É –∫—É—Ä—Å–∞
COURSE_URL = "https://smeetrasulov.ru/govoriiubejdai"
COURSE_BUTTON_TEXT = "üìò –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞ ¬´–ì–æ–≤–æ—Ä–∏ –∏ –£–±–µ–∂–¥–∞–π¬ª"


# ---------- –°–¢–ê–î–ò–ò –î–ò–ê–õ–û–ì–ê ----------

class States(IntEnum):
    ASK_NAME = auto()
    Q1 = auto()
    Q2 = auto()
    Q3 = auto()
    Q4 = auto()
    Q5 = auto()
    Q6 = auto()
    Q7 = auto()
    Q8 = auto()
    Q9 = auto()
    Q10 = auto()
    Q11 = auto()
    Q12 = auto()
    Q13 = auto()
    Q14 = auto()
    Q15 = auto()
    Q16 = auto()
    Q17 = auto()
    Q18 = auto()
    Q19 = auto()
    Q20 = auto()
    WAIT_VIDEO = auto()
    ASK_PHONE = auto()


class SpeakerType(str, Enum):
    ZAZH_VYZH = "zazh_vyzh"
    POTOK_KHAOS = "potok_khaos"
    SUKHOY_EKSPERT = "sukhoy_ekspert"
    HARIZ_KHAOS = "hariz_khaos"
    STABIL_REMESL = "stabil_remesl"
    SISTEM_LIDER = "sistem_lider"


# ---------- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ----------

def answers_keyboard(options):
    return ReplyKeyboardMarkup(
        [[opt] for opt in options],
        resize_keyboard=True,
        one_time_keyboard=True,
    )


def phone_keyboard():
    """
    –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø—Ä–∏ —Å–±–æ—Ä–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞:
    - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç
    - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –∫—É—Ä—Å–∞
    """
    return ReplyKeyboardMarkup(
        [
            [KeyboardButton("üì± –û—Ç–ø—Ä–∞–≤–∏—Ç—å –º–æ–π –∫–æ–Ω—Ç–∞–∫—Ç", request_contact=True)],
            [COURSE_BUTTON_TEXT],
        ],
        resize_keyboard=True,
        one_time_keyboard=True,
    )


def get_user_data(context: ContextTypes.DEFAULT_TYPE):
    if "survey" not in context.user_data:
        context.user_data["survey"] = {}
    return context.user_data["survey"]


def get_user_name(update: Update, context: ContextTypes.DEFAULT_TYPE) -> str:
    """
    –ü—ã—Ç–∞–µ–º—Å—è –≤–∑—è—Ç—å –∏–º—è:
    1) –∏–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (survey["name"])
    2) –∏–∑ Telegram-–ø—Ä–æ—Ñ–∏–ª—è
    """
    data = get_user_data(context)
    name = data.get("name")
    if name:
        return name
    user = update.effective_user
    return user.first_name if user and user.first_name else ""


LETTER_SCORES = {
    "a": 1,
    "b": 2,
    "c": 3,
    "d": 4,
}

VALID_LETTERS = ("a", "b", "c", "d")


def is_valid_abcd(text: str) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—Ç–≤–µ—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–∞ a/b/c/d.
    """
    if not text:
        return False
    t = text.strip().lower()
    return any(t.startswith(letter) for letter in VALID_LETTERS)


def _answer_score(q: str | None) -> int | None:
    """
    –ë–µ—Ä—ë–º –ø–µ—Ä–≤—É—é –±—É–∫–≤—É –æ—Ç–≤–µ—Ç–∞ –∏ –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤ –±–∞–ª–ª 1..4.
    –ï—Å–ª–∏ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞ –∏–ª–∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω–∞—è –±—É–∫–≤–∞ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None.
    """
    if not q:
        return None
    q = q.strip().lower()
    if not q:
        return None
    ch = q[0]
    return LETTER_SCORES.get(ch)


def detect_speaker_type_by_test(data: dict) -> tuple[SpeakerType, dict]:
    """
    –ù–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ 20 –≤–æ–ø—Ä–æ—Å–∞–º.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - —Ç–∏–ø —Å–ø–∏–∫–µ—Ä–∞ (SpeakerType)
    - —Å–ª–æ–≤–∞—Ä—å —à–∫–∞–ª A‚ÄìF
    """

    # --- 1. –°–æ–±–∏—Ä–∞–µ–º –±–∞–ª–ª—ã –ø–æ –∫–∞–∂–¥–æ–º—É –≤–æ–ø—Ä–æ—Å—É ---

    scores = {}
    for i in range(1, 21):
        qi = data.get(f"q{i}")
        scores[i] = _answer_score(qi) or 0  # –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å—á–∏—Ç–∞–µ–º 0

    # --- 2. –°—á–∏—Ç–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –ø–æ —à–∫–∞–ª–∞–º ---

    def avg(indices):
        vals = [scores[i] for i in indices if scores[i] > 0]
        if not vals:
            return 0.0
        return sum(vals) / len(vals)

    # A ‚Äî —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å/—Ç—Ä–µ–≤–æ–≥–∞ (Q1‚ÄìQ4)
    A = avg([1, 2, 3, 4])

    # B ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —è—Å–Ω–æ—Å—Ç—å (Q5‚ÄìQ8)
    B = avg([5, 6, 7, 8])

    # C ‚Äî –≥–æ–ª–æ—Å/–¥–∏–∫—Ü–∏—è/—Ç–µ–º–ø/—Ç–µ–ª–æ (Q9‚ÄìQ12)
    C = avg([9, 10, 11, 12])

    # D ‚Äî –∏–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏—è –∏ –≥–∏–±–∫–æ—Å—Ç—å (Q13‚ÄìQ15)
    D = avg([13, 14, 15])

    # E ‚Äî –≤–ª–∏—è–Ω–∏–µ –∏ —Ö–∞—Ä–∏–∑–º–∞ (Q16‚ÄìQ18)
    E = avg([16, 17, 18])

    # F ‚Äî —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∏ –∞–º–±–∏—Ü–∏–∏ (Q19‚ÄìQ20)
    F = avg([19, 20])

    scales = {"A": A, "B": B, "C": C, "D": D, "E": E, "F": F}

    # --- 3. –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ ---

    # 1) –°–∏—Å—Ç–µ–º–Ω—ã–π –ª–∏–¥–µ—Ä: –≤–µ–∑–¥–µ –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å
    if all(x > 3.0 for x in [A, B, C, D, E, F]):
        return SpeakerType.SISTEM_LIDER, scales

    # 2) –ó–∞–∂–∞—Ç—ã–π –≤—ã–∂–∏–≤–∞–ª—å—â–∏–∫: —Å–∏–ª—å–Ω–∞—è —Ç—Ä–µ–≤–æ–≥–∞, —Å–ª–∞–±—ã–π –≥–æ–ª–æ—Å –∏ –≤–ª–∏—è–Ω–∏–µ
    if A < 2.0 and C < 2.3 and E < 2.3:
        return SpeakerType.ZAZH_VYZH, scales

    # 3) –ü–æ—Ç–æ–∫–æ–≤—ã–π —Ö–∞–æ—Ç–∏–∫: —Å–ª–∞–±–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —Å–∏–ª—å–Ω–∞—è –∏–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏—è –∏ —ç–Ω–µ—Ä–≥–∏—è
    if B < 2.3 and D > 2.7 and (C >= 2.3 or E >= 2.3):
        return SpeakerType.POTOK_KHAOS, scales

    # 4) –°—É—Ö–æ–π —ç–∫—Å–ø–µ—Ä—Ç: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –µ—Å—Ç—å, –Ω–æ —Å–ª–∞–±—ã–π –≥–æ–ª–æ—Å/—Ö–∞—Ä–∏–∑–º–∞
    if B >= 2.7 and (C < 2.3 or E < 2.3):
        return SpeakerType.SUKHOY_EKSPERT, scales

    # 5) –•–∞—Ä–∏–∑–º–∞—Ç–∏—á–Ω—ã–π —Ö–∞–æ—Å: —Å–∏–ª—å–Ω–∞—è —Ö–∞—Ä–∏–∑–º–∞/–≥–æ–ª–æ—Å, —Å–ª–∞–±–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
    if (C >= 3.0 or E >= 3.0) and B < 2.5:
        return SpeakerType.HARIZ_KHAOS, scales

    # 6) –û—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –°—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–º–µ—Å–ª–µ–Ω–Ω–∏–∫
    return SpeakerType.STABIL_REMESL, scales


# ---------- –•–ï–ù–î–õ–ï–†–´ / –ö–û–ú–ê–ù–î–´ ----------

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    –°—Ç–∞—Ä—Ç: –∫–æ—Ä–æ—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ + –∑–∞–ø—Ä–æ—Å –∏–º–µ–Ω–∏.
    """
    intro_text = (
        "–ü—Ä–∏–≤–µ—Ç! üëã\n"
        "–≠—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è *–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–µ—á–∏* –æ—Ç –°–º–∏—Ç–∞.\n\n"
        "–ó–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç —Ç—ã —É–∑–Ω–∞–µ—à—å:\n"
        "‚Äî –Ω–∞—Å–∫–æ–ª—å–∫–æ —É–≤–µ—Ä–µ–Ω–Ω–æ —Ç—ã –≥–æ–≤–æ—Ä–∏—à—å;\n"
        "‚Äî –∫–∞–∫ —Ç–µ–±—è —Å–ª—ã—à–∞—Ç –ª—é–¥–∏;\n"
        "‚Äî –≥–¥–µ –∏–º–µ–Ω–Ω–æ ¬´–ø—Ä–æ—Å–µ–¥–∞—é—Ç¬ª —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –≥–æ–ª–æ—Å –∏ –≤–ª–∏—è–Ω–∏–µ;\n"
        "‚Äî —á—Ç–æ –º–µ—à–∞–µ—Ç –∑–≤—É—á–∞—Ç—å —É–±–µ–¥–∏—Ç–µ–ª—å–Ω–æ.\n\n"
        "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 2 —à–∞–≥–æ–≤:\n"
        "1Ô∏è‚É£ —Ç–µ—Å—Ç –∏–∑ 20 –≤–æ–ø—Ä–æ—Å–æ–≤\n"
        "2Ô∏è‚É£ –≤–∏–¥–µ–æ-–∑–∞–¥–∞–Ω–∏–µ ¬´1 –º–∏–Ω—É—Ç–∞ –æ–±–æ –º–Ω–µ¬ª\n\n"
        "–î–ª—è –Ω–∞—á–∞–ª–∞ –¥–∞–≤–∞–π –ø–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è.\n"
        "–ù–∞–ø–∏—à–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç üôÇ"
    )
    await update.message.reply_text(intro_text, parse_mode="Markdown")
    return States.ASK_NAME


async def help_cmd(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "–≠—Ç–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–µ—á–∏ –æ—Ç –°–º–∏—Ç–∞.\n\n"
        "/start ‚Äî –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ\n"
        "/cancel ‚Äî –ø—Ä–µ—Ä–≤–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É\n\n"
        "–ü—Ä–æ—Å—Ç–æ —Å–ª–µ–¥—É–π –≤–æ–ø—Ä–æ—Å–∞–º –∏ –Ω–∞–∂–∏–º–∞–π –Ω–∞ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤."
    )


async def save_name_and_start_test(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –≤–æ–ø—Ä–æ—Å—É 1.
    """
    data = get_user_data(context)
    name = (update.message.text or "").strip()
    data["name"] = name

    greet = f"{name}, " if name else ""

    text = (
        f"{greet}–Ω–∞—á–Ω—ë–º —Å —Ç–µ—Å—Ç–∞.\n\n"
        "–í–æ–ø—Ä–æ—Å 1 –∏–∑ 20\n\n"
        "–ö–∞–∫ —Ç—ã —Ä–µ–∞–≥–∏—Ä—É–µ—à—å –Ω–∞ —Å–∞–º —Ñ–∞–∫—Ç, —á—Ç–æ –Ω—É–∂–Ω–æ –≤—ã—Å—Ç—É–ø–∏—Ç—å (–æ—Ñ–ª–∞–π–Ω –∏–ª–∏ –æ–Ω–ª–∞–π–Ω)?"
    )
    options = [
        "a) –•–æ—á—É –ª—é–±—ã–º —Å–ø–æ—Å–æ–±–æ–º –∏–∑–±–µ–∂–∞—Ç—å, –≤–ø–ª–æ—Ç—å –¥–æ –æ—Ç–∫–∞–∑–∞",
        "b) –°–æ–≥–ª–∞—à–∞—é—Å—å, –Ω–æ –≤–Ω—É—Ç—Ä–∏ —Å–∏–ª—å–Ω–æ–µ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –∏ –º—ã—Å–ª–∏ ¬´–∑–∞—á–µ–º —è –≤ —ç—Ç–æ –≤–≤—è–∑–∞–ª—Å—è(–∞—Å—å)?¬ª",
        "c) –í–æ–ª–Ω—É—Å—å, –Ω–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é –∫–∞–∫ –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä—É—é –º–æ–≥—É –≤—ã–ø–æ–ª–Ω–∏—Ç—å",
        "d) –ß–∞—â–µ –∏—Å–ø—ã—Ç—ã–≤–∞—é –∞–∑–∞—Ä—Ç –∏ –∏–Ω—Ç–µ—Ä–µ—Å, —á–µ–º —Å—Ç—Ä–∞—Ö",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q1


# --- –í–û–ü–†–û–°–´ Q1‚ÄìQ20 (—Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π a/b/c/d) ---

async def save_q1_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q1

    data = get_user_data(context)
    data["q1"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 2 –∏–∑ 20\n\n"
        "–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å —Ç–≤–æ–∏–º —Ç–µ–ª–æ–º –∏ —ç–º–æ—Ü–∏—è–º–∏ –∑–∞ 10‚Äì15 –º–∏–Ω—É—Ç –¥–æ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è?"
    )
    options = [
        "a) –°–µ—Ä–¥—Ü–µ –∫–æ–ª–æ—Ç–∏—Ç—Å—è, —Ä—É–∫–∏/–Ω–æ–≥–∏ —Ç—Ä—è—Å—É—Ç—Å—è, –≤ –≥–æ–ª–æ–≤–µ –ø–∞–Ω–∏–∫–∞",
        "b) –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ –≤—ã—Å–æ–∫–æ–µ, –º–Ω–æ–≥–æ —Ç—Ä–µ–≤–æ–∂–Ω—ã—Ö –º—ã—Å–ª–µ–π, –Ω–æ —É–¥–∞—ë—Ç—Å—è –¥–µ—Ä–∂–∞—Ç—å—Å—è",
        "c) –ï—Å—Ç—å –≤–æ–ª–Ω–µ–Ω–∏–µ, –Ω–æ –æ–Ω–æ –±–æ–ª—å—à–µ –º–æ–±–∏–ª–∏–∑—É–µ—Ç, —á–µ–º –º–µ—à–∞–µ—Ç",
        "d) –°–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ–µ–≤–æ–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏, —Å–ø–æ–∫–æ–π–Ω–æ —Å–æ–±–∏—Ä–∞—é—Å—å –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Å—å",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q2


async def save_q2_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q2

    data = get_user_data(context)
    data["q2"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 3 –∏–∑ 20\n\n"
        "–ö–∞–∫ —Ç—ã –æ—Ç–Ω–æ—Å–∏—à—å—Å—è –∫ –∫—Ä–∏—Ç–∏–∫–µ –∏ –≤–æ–∑–º–æ–∂–Ω–æ–º—É ¬´–ø—Ä–æ–≤–∞–ª—É¬ª –ø—Ä–∏ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–∏?"
    )
    options = [
        "a) –ü–∞–Ω–∏—á–µ—Å–∫–∏ –±–æ—é—Å—å, —ç—Ç–æ –¥–ª—è –º–µ–Ω—è –ø–æ—á—Ç–∏ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞",
        "b) –û—á–µ–Ω—å –Ω–µ —Ö–æ—á—É –æ—à–∏–±–∏—Ç—å—Å—è, —Å–∏–ª—å–Ω–æ –ø–µ—Ä–µ–∂–∏–≤–∞—é, –Ω–æ –≤—Å—ë-—Ç–∞–∫–∏ –≤—ã—Å—Ç—É–ø–∞—é",
        "c) –ü–æ–Ω–∏–º–∞—é, —á—Ç–æ –æ—à–∏–±–∫–∏ ‚Äî —á–∞—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ–º–Ω–æ–≥–æ —Ü–µ–ø–ª—è–µ—Ç",
        "d) –°–ø–æ–∫–æ–π–Ω–æ –æ—Ç–Ω–æ—à—É—Å—å, –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é –∫–∞–∫ –æ–ø—ã—Ç –∏ –º–∞—Ç–µ—Ä–∏–∞–ª –¥–ª—è —Ä–æ—Å—Ç–∞",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q3


async def save_q3_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q3

    data = get_user_data(context)
    data["q3"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 4 –∏–∑ 20\n\n"
        "–ö–∞–∫ —á–∞—Å—Ç–æ —Ç—ã –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—à—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—é –∏–∑-–∑–∞ —Ç—Ä–µ–≤–æ–≥–∏ –∏–ª–∏ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–∏?"
    )
    options = [
        "a) –ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞, —Ç—è–Ω—É –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ, –∏–Ω–æ–≥–¥–∞ –≤–æ–æ–±—â–µ —Å–ª–∏–≤–∞—é –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ",
        "b) –ß–∞—Å—Ç–æ —Ç—è–Ω—É —Å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–æ–π, –Ω–∞—á–∏–Ω–∞—é –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–æ–º–µ–Ω—Ç",
        "c) –ò–Ω–æ–≥–¥–∞ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—é, –Ω–æ –≤—Å—ë –∂–µ –Ω–∞—Ö–æ–∂—É –≤—Ä–µ–º—è –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è",
        "d) –û–±—ã—á–Ω–æ –≥–æ—Ç–æ–≤–ª—é—Å—å –∑–∞—Ä–∞–Ω–µ–µ –∏ –±–µ–∑ —Å–∏–ª—å–Ω–æ–≥–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q4


async def save_q4_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q4

    data = get_user_data(context)
    data["q4"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 5 –∏–∑ 20\n\n"
        "–ß—Ç–æ –æ–±—ã—á–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å —Ç–≤–æ–µ–π –º—ã—Å–ª—å—é –≤–æ –≤—Ä–µ–º—è —Ä–µ—á–∏?"
    )
    options = [
        "a) –ß–∞—Å—Ç–æ —Ç–µ—Ä—è—é –º—ã—Å–ª—å, –∑–∞–º–æ–ª–∫–∞—é –∏–ª–∏ —É—Ö–æ–∂—É –≤ —Å—Ç–æ—Ä–æ–Ω—É –∏ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Å—å –∫ —Ç–µ–º–µ",
        "b) –†–µ–≥—É–ª—è—Ä–Ω–æ ¬´—É–ø–ª—ã–≤–∞—é¬ª –æ—Ç —Ç–µ–º—ã, –ø–æ—Ç–æ–º —Å —Ç—Ä—É–¥–æ–º –≤–æ–∑–≤—Ä–∞—â–∞—é—Å—å",
        "c) –ò–Ω–æ–≥–¥–∞ —Å–±–∏–≤–∞—é—Å—å, –Ω–æ –≤ —Ü–µ–ª–æ–º —É–º–µ—é –¥–æ–≤–æ–¥–∏—Ç—å –º—ã—Å–ª—å –¥–æ –∫–æ–Ω—Ü–∞",
        "d) –î–µ—Ä–∂—É –ª–∏–Ω–∏—é –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞ –∏ —É–ø—Ä–∞–≤–ª—è—é –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q5


async def save_q5_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q5

    data = get_user_data(context)
    data["q5"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 6 –∏–∑ 20\n\n"
        "–ù–∞—Å–∫–æ–ª—å–∫–æ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ —Ç—ã –≤—ã—Å—Ç—Ä–∞–∏–≤–∞–µ—à—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è?"
    )
    options = [
        "a) –í—ã—Å—Ç—É–ø–∞—é –ø–æ—á—Ç–∏ –±–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: –∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—Å—è, —Ç–∞–∫ –ø–æ–ª—É—á–∏—Ç—Å—è",
        "b) –ü—Ä–∏–º–µ—Ä–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é, –æ —á—ë–º —Å–∫–∞–∂—É, –Ω–æ —á—ë—Ç–∫–æ–π —Å—Ö–µ–º—ã –Ω–µ—Ç",
        "c) –û–±—ã—á–Ω–æ –µ—Å—Ç—å –ø–ª–∞–Ω/—Å–∫–µ–ª–µ—Ç: –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ, –æ—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å, –≤—ã–≤–æ–¥—ã",
        "d) –í—Å–µ–≥–¥–∞ –ø—Ä–æ–¥—É–º—ã–≤–∞—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É: –∫—Ä—é—á–æ–∫, –ª–æ–≥–∏–∫–∞, –∞–∫—Ü–µ–Ω—Ç—ã, —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q6


async def save_q6_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q6

    data = get_user_data(context)
    data["q6"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 7 –∏–∑ 20\n\n"
        "–ö–∞–∫ —Ç—ã –æ–±—ä—è—Å–Ω—è–µ—à—å —Å–ª–æ–∂–Ω—ã–µ –º—ã—Å–ª–∏ –∏–ª–∏ —Ç–µ–º—ã –ª—é–¥—è–º?"
    )
    options = [
        "a) –ë—ã—Å—Ç—Ä–æ —Ç–µ—Ä—è—é—Å—å, —É—Ö–æ–∂—É –≤ –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã, —Å–∞–º(–∞) –ø—É—Ç–∞—é—Å—å",
        "b) –ß–∞—Å—Ç–æ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—é –¥–µ—Ç–∞–ª—è–º–∏ –∏–ª–∏ —Ç–µ—Ä–º–∏–Ω–∞–º–∏, —Å–ª—É—à–∞—Ç–µ–ª—è–º —Ç—è–∂–µ–ª–æ",
        "c) –í —Ü–µ–ª–æ–º –º–æ–≥—É –æ–±—ä—è—Å–Ω–∏—Ç—å, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ—Å—Ç–æ –∏ –æ–±—Ä–∞–∑–Ω–æ",
        "d) –£–º–µ—é –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å —Å–ª–æ–∂–Ω–æ–µ –≤ –ø—Ä–æ—Å—Ç–æ–µ: –ø—Ä–∏–º–µ—Ä—ã, –º–µ—Ç–∞—Ñ–æ—Ä—ã, –∏—Å—Ç–æ—Ä–∏–∏",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q7


async def save_q7_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q7

    data = get_user_data(context)
    data["q7"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 8 –∏–∑ 20\n\n"
        "–ö–∞–∫ —Ç—ã –æ–±—ã—á–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—à—å —Å–≤–æ–∏ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è –∏–ª–∏ –æ—Ç–≤–µ—Ç—ã?"
    )
    options = [
        "a) –†–µ—á—å –æ–±—Ä—ã–≤–∞–µ—Ç—Å—è —Å–∞–º–∞, –±–µ–∑ –≤—ã–≤–æ–¥–∞ –∏ –ø–æ–Ω—è—Ç–Ω–æ–≥–æ —Ñ–∏–Ω–∞–ª–∞",
        "b) –ò–Ω–æ–≥–¥–∞ —á—Ç–æ-—Ç–æ –¥–æ–±–∞–≤–ª—è—é –≤ –∫–æ–Ω—Ü–µ, –Ω–æ —á–∞—â–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é ¬´–∫–∞–∫ –ø—Ä–∏–¥—ë—Ç—Å—è¬ª",
        "c) –°—Ç–∞—Ä–∞—é—Å—å –¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥, –Ω–æ –æ–Ω –Ω–µ –≤—Å–µ–≥–¥–∞ –∑–≤—É—á–∏—Ç —Å–∏–ª—å–Ω–æ –∏ —á—ë—Ç–∫–æ",
        "d) –û—Å–æ–∑–Ω–∞–Ω–Ω–æ –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—é —Ñ–∏–Ω–∞–ª: —Ä–µ–∑—é–º–µ, –≤—ã–≤–æ–¥, –ø—Ä–∏–∑—ã–≤ –∏–ª–∏ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q8


async def save_q8_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q8

    data = get_user_data(context)
    data["q8"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 9 –∏–∑ 20\n\n"
        "–ö–∞–∫ —Ç—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—à—å —Å–≤–æ–π –≥–æ–ª–æ—Å –ø—Ä–∏ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è—Ö?"
    )
    options = [
        "a) –¢–∏—Ö–∏–π, –∑–∞–∂–∞—Ç—ã–π, –º–µ–Ω—è —á–∞—Å—Ç–æ –ø–ª–æ—Ö–æ —Å–ª—ã—à–Ω–æ –∏–ª–∏ –ø—Ä–æ—Å—è—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å",
        "b) –ù–µ—Ä–æ–≤–Ω—ã–π: —Ç–æ —Å–ª–∏—à–∫–æ–º —Ç–∏—Ö–æ, —Ç–æ —Ä–µ–∑–∫–æ –≥—Ä–æ–º–∫–æ, —á—É–≤—Å—Ç–≤—É—é –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
        "c) –í —Ü–µ–ª–æ–º –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π, –Ω–æ –∏–Ω–æ–≥–¥–∞ ¬´–ø—Ä–æ—Å–µ–¥–∞–µ—Ç¬ª –∏–ª–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–æ–Ω–æ—Ç–æ–Ω–Ω—ã–º",
        "d) –ì–æ–ª–æ—Å –∂–∏–≤–æ–π, —É–≤–µ—Ä–µ–Ω–Ω—ã–π, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π: –º–æ–≥—É –º–µ–Ω—è—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å –∏ –æ–∫—Ä–∞—Å–∫—É",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q9


async def save_q9_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q9

    data = get_user_data(context)
    data["q9"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 10 –∏–∑ 20\n\n"
        "–ß—Ç–æ —Å –¥–∏–∫—Ü–∏–µ–π –∏ —á—ë—Ç–∫–æ—Å—Ç—å—é —Ä–µ—á–∏?"
    )
    options = [
        "a) –ß–∞—Å—Ç–æ ¬´–∫–∞—à–∞ –≤–æ —Ä—Ç—É¬ª, –ø—Ä–æ–≥–ª–∞—Ç—ã–≤–∞—é –æ–∫–æ–Ω—á–∞–Ω–∏—è, —Å–∞–º–æ–º—É(–æ–π) —Å—Ç—ã–¥–Ω–æ —Å–ª—É—à–∞—Ç—å",
        "b) –ó–∞–º–µ—á–∞—é, —á—Ç–æ —Å–ø–æ—Ç—ã–∫–∞—é—Å—å, –∑–∞–ø–∏–Ω–∞—é—Å—å, –ø—É—Ç–∞—é —Å–ª–æ–≤–∞, –∫–æ–≥–¥–∞ –≤–æ–ª–Ω—É—é—Å—å",
        "c) –í –æ–±—ã—á–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –≥–æ–≤–æ—Ä—é –±–æ–ª–µ–µ-–º–µ–Ω–µ–µ —á—ë—Ç–∫–æ, –Ω–æ –Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ",
        "d) –ß—ë—Ç–∫–∞—è –∞—Ä—Ç–∏–∫—É–ª—è—Ü–∏—è, —Å–ª–æ–≤–∞ –∑–≤—É—á–∞—Ç —è—Å–Ω–æ –∏ —Ä–∞–∑–±–æ—Ä—á–∏–≤–æ –¥–∞–∂–µ –ø—Ä–∏ –≤–æ–ª–Ω–µ–Ω–∏–∏",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q10


async def save_q10_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q10

    data = get_user_data(context)
    data["q10"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 11 –∏–∑ 20\n\n"
        "–ö–∞–∫–æ–π —É —Ç–µ–±—è –æ–±—ã—á–Ω–æ —Ç–µ–º–ø —Ä–µ—á–∏ –ø—Ä–∏ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–∏?"
    )
    options = [
        "a) –õ–∏–±–æ ¬´—Ç–æ—Ä–æ–ø–ª—é—Å—å¬ª, —Ç–∞—Ä–∞—Ç–æ—Ä—é, –ª–∏–±–æ —Å–æ–≤—Å–µ–º –∑–∞–∂–∏–º–∞—é—Å—å –∏ –≥–æ–≤–æ—Ä—é —Ä—ã–≤–∫–∞–º–∏",
        "b) –ß–∞—Å—Ç–æ –≥–æ–≤–æ—Ä—é —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ, –∑–∞–±—ã–≤–∞—é –¥–µ–ª–∞—Ç—å –ø–∞—É–∑—ã",
        "c) –ò–Ω–æ–≥–¥–∞ —Å–±–∏–≤–∞—é—Å—å —Å —Ç–µ–º–ø–∞, –Ω–æ —Å—Ç–∞—Ä–∞—é—Å—å —Å–ª–µ–¥–∏—Ç—å",
        "d) –û—Å–æ–∑–Ω–∞–Ω–Ω–æ —É–ø—Ä–∞–≤–ª—è—é —Ç–µ–º–ø–æ–º: –≥–¥–µ-—Ç–æ —É—Å–∫–æ—Ä—è—é—Å—å, –≥–¥–µ-—Ç–æ –∑–∞–º–µ–¥–ª—è—é—Å—å –∏ –¥–µ–ª–∞—é –ø–∞—É–∑—ã",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q11


async def save_q11_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q11

    data = get_user_data(context)
    data["q11"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 12 –∏–∑ 20\n\n"
        "–ù–∞—Å–∫–æ–ª—å–∫–æ —Ç—ã –æ—Å–æ–∑–Ω–∞—ë—à—å —Å–≤–æ—é –º–∏–º–∏–∫—É, –∂–µ—Å—Ç—ã –∏ –ø–æ–∑—É –≤–æ –≤—Ä–µ–º—è —Ä–µ—á–∏?"
    )
    options = [
        "a) –ü–æ—á—Ç–∏ –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é —Ç–µ–ª–æ, —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –¥–µ—Ä–µ–≤—è–Ω–Ω–æ –∏–ª–∏ –∑–∞–∂–∞—Ç–æ",
        "b) –ó–∞–º–µ—á–∞—é –Ω–µ–∫–æ—Ç–æ—Ä—É—é –∑–∞–∂–∞—Ç–æ—Å—Ç—å –∏–ª–∏ —Ö–∞–æ—Ç–∏—á–Ω—ã–µ –∂–µ—Å—Ç—ã, –Ω–æ –Ω–µ –∑–Ω–∞—é, –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å",
        "c) –ß–∞—Å—Ç–∏—á–Ω–æ –æ—Å–æ–∑–Ω–∞—é, –∏–Ω–æ–≥–¥–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é –∂–µ—Å—Ç—ã –∏ –∫–æ–Ω—Ç–∞–∫—Ç –≤–∑–≥–ª—è–¥–æ–º",
        "d) –û—Å–æ–∑–Ω–∞–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—é —Ç–µ–ª–æ–º: –∂–µ—Å—Ç—ã, –º–∏–º–∏–∫–∞, –≤–∑–≥–ª—è–¥ –ø–æ–º–æ–≥–∞—é—Ç —É—Å–∏–ª–∏–≤–∞—Ç—å —Å–º—ã—Å–ª",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q12


async def save_q12_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q12

    data = get_user_data(context)
    data["q12"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 13 –∏–∑ 20\n\n"
        "–ö–∞–∫ —Ç—ã —Ä–µ–∞–≥–∏—Ä—É–µ—à—å, –∫–æ–≥–¥–∞ —Ç–µ–±—è –≤–Ω–µ–∑–∞–ø–Ω–æ –ø—Ä–æ—Å—è—Ç –≤—ã—Å—Ç—É–ø–∏—Ç—å –±–µ–∑ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏?"
    )
    options = [
        "a) –•–æ—á–µ—Ç—Å—è –ø—Ä–æ–≤–∞–ª–∏—Ç—å—Å—è –ø–æ–¥ –∑–µ–º–ª—é, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∏–∑–±–µ–≥–∞—é —Ç–∞–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏–π",
        "b) –û—á–µ–Ω—å –Ω–µ—Ä–≤–Ω–∏—á–∞—é, —Ä–µ—á—å –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å–±–∏–≤—á–∏–≤–∞—è –∏ –∫—É—Å–æ—á–Ω–∞—è",
        "c) –ú–æ–≥—É —á—Ç–æ-—Ç–æ —Å–∫–∞–∑–∞—Ç—å, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ —ç—Ç–æ –∑–≤—É—á–∏—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ",
        "d) –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ —Ä–µ–∞–≥–∏—Ä—É—é, –º–æ–≥—É —Å–æ–±—Ä–∞—Ç—å –º—ã—Å–ª–∏ –∏ –≤—ã–¥–∞—Ç—å –≤–Ω—è—Ç–Ω—É—é —Ä–µ—á—å",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q13


async def save_q13_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q13

    data = get_user_data(context)
    data["q13"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 14 –∏–∑ 20\n\n"
        "–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ —Ç–µ–±–µ –∑–∞–¥–∞—é—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Å—Ç—Ä—ã–π/—Å–ª–æ–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å –ø—Ä–∏ –¥—Ä—É–≥–∏—Ö?"
    )
    options = [
        "a) –°—Ç—É–ø–æ—Ä, –∫—Ä–∞—Å–Ω–µ—é, —Ö–æ—á–µ—Ç—Å—è –ø–æ—Å–∫–æ—Ä–µ–µ –∑–∞–∫–æ–Ω—á–∏—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä",
        "b) –¢–µ—Ä—è—é—Å—å, –æ—Ç–≤–µ—á–∞—é —Ä–∞—Å–ø–ª—ã–≤—á–∞—Ç–æ, —É—Ö–æ–∂—É –æ—Ç –ø—Ä—è–º–æ–≥–æ –æ—Ç–≤–µ—Ç–∞",
        "c) –ù–µ–º–Ω–æ–≥–æ –ø—É—Ç–∞—é—Å—å, –Ω–æ –≤—Å—ë-—Ç–∞–∫–∏ –æ—Ç–≤–µ—á–∞—é –ø–æ —Å—É—Ç–∏",
        "d) –°–æ—Ö—Ä–∞–Ω—è—é —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ, –º–æ–≥—É –≤—ã–¥–∞—Ç—å —è—Å–Ω—ã–π, –∞—Ä–≥—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q14


async def save_q14_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q14

    data = get_user_data(context)
    data["q14"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 15 –∏–∑ 20\n\n"
        "–ù–∞—Å–∫–æ–ª—å–∫–æ –ª–µ–≥–∫–æ —Ç–µ–±–µ –º–µ–Ω—è—Ç—å —Ö–æ–¥ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è –ø–æ —Å–∏—Ç—É–∞—Ü–∏–∏ "
        "(–≤—Ä–µ–º—è —Å–æ–∫—Ä–∞—Ç–∏–ª–∏, –∞—É–¥–∏—Ç–æ—Ä–∏—è –¥—Ä—É–≥–∞—è, —Ç–µ–º–∞ —É–µ—Ö–∞–ª–∞)?"
    )
    options = [
        "a) –í–æ–æ–±—â–µ –Ω–µ —É–º–µ—é: –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ –ø–æ –ø–ª–∞–Ω—É ‚Äî —è —Ç–µ—Ä—è—é—Å—å",
        "b) –° —Ç—Ä—É–¥–æ–º –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞—é—Å—å, –∫–∞—á–µ—Å—Ç–≤–æ —Ä–µ—á–∏ —Å–∏–ª—å–Ω–æ –ø–∞–¥–∞–µ—Ç",
        "c) –ú–æ–≥—É –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è, –Ω–æ —Å –∑–∞–º–µ—Ç–Ω—ã–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ–º",
        "d) –ì–∏–±–∫–æ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞—é—Å—å –ø–æ–¥ —Å–∏—Ç—É–∞—Ü–∏—é, –º–æ–≥—É —Å–æ–∫—Ä–∞—â–∞—Ç—å/–º–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–∞ —Ö–æ–¥—É",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q15


async def save_q15_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q15

    data = get_user_data(context)
    data["q15"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 16 –∏–∑ 20\n\n"
        "–ö–∞–∫ —á–∞—Å—Ç–æ —Ç—ã –∑–∞–º–µ—á–∞–µ—à—å, —á—Ç–æ –ª—é–¥–∏ —Ä–µ–∞–ª—å–Ω–æ –≤–æ–≤–ª–µ–∫–∞—é—Ç—Å—è, –∫–æ–≥–¥–∞ —Ç—ã –≥–æ–≤–æ—Ä–∏—à—å "
        "(—Å–º–æ—Ç—Ä—è—Ç, –∫–∏–≤–∞—é—Ç, –∑–∞–¥–∞—é—Ç –≤–æ–ø—Ä–æ—Å—ã)?"
    )
    options = [
        "a) –†–µ–¥–∫–æ, —á–∞—â–µ –≤–∏–∂—É —Å–∫—É–∫—É –∏–ª–∏ –æ—Ç—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–æ—Å—Ç—å",
        "b) –ò–Ω–æ–≥–¥–∞ —É–¥–∞—ë—Ç—Å—è –∑–∞—Ü–µ–ø–∏—Ç—å, –Ω–æ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ",
        "c) –í —Ü–µ–ª–æ–º –ª—é–¥–∏ —Å–ª—É—à–∞—é—Ç, –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –≤–æ–≤–ª–µ–∫–∞—é—Ç—Å—è",
        "d) –ß–∞—Å—Ç–æ –≤–∏–∂—É –∂–∏–≤–æ–π –∏–Ω—Ç–µ—Ä–µ—Å, —Ä–µ–∞–∫—Ü–∏—é, –≤–æ–ø—Ä–æ—Å—ã, –ª—é–¥–∏ —è–≤–Ω–æ ¬´–≤–Ω—É—Ç—Ä–∏¬ª –º–æ–µ–π —Ä–µ—á–∏",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q16


async def save_q16_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q16

    data = get_user_data(context)
    data["q16"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 17 –∏–∑ 20\n\n"
        "–ö–∞–∫ –æ–±—ã—á–Ω–æ —Ç—ã –≤–æ–∑–¥–µ–π—Å—Ç–≤—É–µ—à—å –Ω–∞ —Ä–µ—à–µ–Ω–∏—è –ª—é–¥–µ–π —á–µ—Ä–µ–∑ —Ä–µ—á—å "
        "(—É–±–µ–¥–∏—Ç—å, –ø—Ä–æ–¥–∞—Ç—å –∏–¥–µ—é, –≤–¥–æ—Ö–Ω–æ–≤–∏—Ç—å)?"
    )
    options = [
        "a) –ü–æ—á—Ç–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –º–µ–Ω—è —Å–∫–æ—Ä–µ–µ –≤–µ–∂–ª–∏–≤–æ –≤—ã—Å–ª—É—à–∏–≤–∞—é—Ç",
        "b) –ò–Ω–æ–≥–¥–∞ —É–¥–∞—ë—Ç—Å—è —É–±–µ–¥–∏—Ç—å, –Ω–æ —á–∞—Å—Ç–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏–ª–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏",
        "c) –í —Ü–µ–ª–æ–º —É–º–µ—é –¥–æ–Ω–æ—Å–∏—Ç—å —Å–≤–æ—é –ø–æ–∑–∏—Ü–∏—é –∏ –≤–ª–∏—è—Ç—å –Ω–∞ —Ä–µ—à–µ–Ω–∏—è",
        "d) –û—Å–æ–∑–Ω–∞–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –∏—Å—Ç–æ—Ä–∏–∏, —ç–º–æ—Ü–∏–∏, –∏ —ç—Ç–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –º–µ–Ω—è–µ—Ç —Ä–µ—à–µ–Ω–∏—è –ª—é–¥–µ–π",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q17


async def save_q17_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q17

    data = get_user_data(context)
    data["q17"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 18 –∏–∑ 20\n\n"
        "–ö–∞–∫—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å —Ç—ã —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–ª—É—á–∞–µ—à—å –æ —Å–≤–æ–µ–π —Ä–µ—á–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö?"
    )
    options = [
        "a) ¬´–¢–µ–±—è –ø–ª–æ—Ö–æ —Å–ª—ã—à–Ω–æ/–Ω–µ–ø–æ–Ω—è—Ç–Ω–æ¬ª, ¬´—Ç—ã —Ç–µ—Ä—è–µ—à—å—Å—è¬ª, ¬´–≥–æ–≤–æ—Ä–∏ —É–≤–µ—Ä–µ–Ω–Ω–µ–µ¬ª",
        "b) ¬´–°–ª–∏—à–∫–æ–º —Å—É–º–±—É—Ä–Ω–æ¬ª, ¬´—Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ¬ª, ¬´—Ç—ã —Å–∫–∞—á–µ—à—å —Å —Ç–µ–º—ã –Ω–∞ —Ç–µ–º—É¬ª",
        "c) ¬´–í —Ü–µ–ª–æ–º –Ω–æ—Ä–º–∞–ª—å–Ω–æ¬ª, ¬´–≥–æ–≤–æ—Ä–∏—à—å –∞–¥–µ–∫–≤–∞—Ç–Ω–æ¬ª, –Ω–æ –±–µ–∑ —è—Ä–∫–∏—Ö –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–æ–≤",
        "d) ¬´–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ¬ª, ¬´—Ö–∞—Ä–∏–∑–º–∞—Ç–∏—á–Ω–æ¬ª, ¬´—Ç—ã –∫–ª–∞—Å—Å–Ω–æ –¥–æ–Ω–æ—Å–∏—à—å¬ª, ¬´—Ö–æ—á–µ—Ç—Å—è —Å–ª—É—à–∞—Ç—å –¥–∞–ª—å—à–µ¬ª",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q18


async def save_q18_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q18

    data = get_user_data(context)
    data["q18"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 19 –∏–∑ 20\n\n"
        "–ù–∞—Å–∫–æ–ª—å–∫–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ —Ç—ã —Ç—Ä–µ–Ω–∏—Ä—É–µ—à—å —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏ —Ä–µ—á–∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ?"
    )
    options = [
        "a) –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∫–æ–≥–¥–∞, –ø—Ä–æ—Å—Ç–æ –∂–∏–≤—É –∏ –≥–æ–≤–æ—Ä—é, –∫–∞–∫ –≥–æ–≤–æ—Ä—é",
        "b) –ò–Ω–æ–≥–¥–∞ —Å—Ç–∞—Ä–∞—é—Å—å —á—Ç–æ-—Ç–æ –ø–æ—á–∏—Ç–∞—Ç—å/–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –Ω–æ –±–µ–∑ —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–∞–∫—Ç–∏–∫–∏",
        "c) –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Ç—Ä–µ–Ω–∏—Ä—É—é—Å—å: –≤—ã—Å—Ç—É–ø–∞—é, –∑–∞–ø–∏—Å—ã–≤–∞—é —Å–µ–±—è, –ø—Ä–æ–±—É—é –Ω–æ–≤—ã–µ –ø—Ä–∏—ë–º—ã",
        "d) –≠—Ç–æ —á–∞—Å—Ç—å –º–æ–µ–π –∂–∏–∑–Ω–∏: —è –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ –ø—Ä–æ–∫–∞—á–∏–≤–∞—é —Ä–µ—á—å, –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –∏ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞—é –Ω–∞–≤—ã–∫–∏",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q19


async def save_q19_and_next(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q19

    data = get_user_data(context)
    data["q19"] = update.message.text

    text = (
        "–í–æ–ø—Ä–æ—Å 20 –∏–∑ 20\n\n"
        "–ù–∞ –∫–∞–∫–æ–º —É—Ä–æ–≤–Ω–µ —Ç—ã —Ö–æ—Ç–µ–ª(–∞) –±—ã –±—ã—Ç—å –∫–∞–∫ —Å–ø–∏–∫–µ—Ä –≤ –±–ª–∏–∂–∞–π—à–∏–π –≥–æ–¥?"
    )
    options = [
        "a) –ü—Ä–æ—Å—Ç–æ –Ω–µ –±–æ—è—Ç—å—Å—è –≥–æ–≤–æ—Ä–∏—Ç—å –≤—Å–ª—É—Ö –∏ –ø–µ—Ä–µ—Å—Ç–∞—Ç—å –∑–∞–∏–∫–∞—Ç—å—Å—è/–∑–∞–∂–∏–º–∞—Ç—å—Å—è",
        "b) –£–≤–µ—Ä–µ–Ω–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç—å –≤ —Ä–∞–±–æ—á–∏—Ö/—É—á–µ–±–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö, –±–µ–∑ –ø–∞–Ω–∏–∫–∏ –∏ –ø—Ä–æ–≤–∞–ª–æ–≤",
        "c) –£–º–µ—Ç—å –≤—ã—Å—Ç—É–ø–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ, —É–±–µ–¥–∏—Ç–µ–ª—å–Ω–æ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –ø–µ—Ä–µ–¥ –ª—é–±—ã–º–∏ –∞—É–¥–∏—Ç–æ—Ä–∏—è–º–∏",
        "d) –ë—ã—Ç—å —Å–∏–ª—å–Ω—ã–º, —É–∑–Ω–∞–≤–∞–µ–º—ã–º —Å–ø–∏–∫–µ—Ä–æ–º/–ª–∏–¥–µ—Ä–æ–º –º–Ω–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–π –≤–ª–∏—è–µ—Ç –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç",
    ]
    await update.message.reply_text(text, reply_markup=answers_keyboard(options))
    return States.Q20


async def save_q20_and_ask_video(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not is_valid_abcd(update.message.text or ""):
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá"
        )
        return States.Q20

    data = get_user_data(context)
    data["q20"] = update.message.text

    name = get_user_name(update, context)
    name_part = f"{name}, " if name else ""

    text = (
        "–¢–µ—Å—Ç–æ–≤–∞—è —á–∞—Å—Ç—å –≥–æ—Ç–æ–≤–∞! ‚úÖ\n\n"
        f"{name_part}—Ç–µ–ø–µ—Ä—å ‚Äî —Å–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ.\n"
        "–ß—Ç–æ–±—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –±—ã–ª–∞ —á–µ—Å—Ç–Ω–æ–π –∏ —Ç–æ—á–Ω–æ–π, –Ω—É–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å, –ö–ê–ö —Ç—ã –≥–æ–≤–æ—Ä–∏—à—å –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ.\n\n"
        "üé• –ó–∞–¥–∞–Ω–∏–µ ¬´1 –º–∏–Ω—É—Ç–∞ –æ–±–æ –º–Ω–µ¬ª\n\n"
        "–í–∫–ª—é—á–∏ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—É—é –∫–∞–º–µ—Ä—É –∏ –∑–∞–ø–∏—à–∏ –≤–∏–¥–µ–æ –¥–æ 60 —Å–µ–∫—É–Ω–¥.\n"
        "–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ –∑–Ω–∞–∫–æ–º–∏—à—å—Å—è —Å –≤–∞–∂–Ω—ã–º –¥–ª—è —Ç–µ–±—è —á–µ–ª–æ–≤–µ–∫–æ–º.\n\n"
        "–†–∞—Å—Å–∫–∞–∂–∏:\n"
        "‚Äî –∫—Ç–æ —Ç—ã;\n"
        "‚Äî —á–µ–º –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è;\n"
        "‚Äî —á–µ–º –º–æ–∂–µ—à—å –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω –ª—é–¥—è–º.\n\n"
        "–ù–µ –≥–æ—Ç–æ–≤—å —Ç–µ–∫—Å—Ç –∑–∞—Ä–∞–Ω–µ–µ. –ì–æ–≤–æ—Ä–∏ —Ç–∞–∫, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏—à—å –≤ –∂–∏–∑–Ω–∏.\n\n"
        "–ö–æ–≥–¥–∞ –±—É–¥–µ—à—å –≥–æ—Ç–æ–≤(–∞) ‚Äî –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å —Å—é–¥–∞ –≤–∏–¥–µ–æ."
    )
    await update.message.reply_text(text, reply_markup=ReplyKeyboardRemove())
    return States.WAIT_VIDEO


# ---------- –í–ò–î–ï–û –ò –†–ï–ó–£–õ–¨–¢–ê–¢–´ ----------

async def handle_video(update: Update, context: ContextTypes.DEFAULT_TYPE):
    data = get_user_data(context)
    message = update.message

    if message.video:
        file_id = message.video.file_id
        data["video_type"] = "video"
    elif message.video_note:
        file_id = message.video_note.file_id
        data["video_type"] = "video_note"
    else:
        await message.reply_text("–ù—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–º–µ–Ω–Ω–æ –≤–∏–¥–µ–æ üìπ")
        return States.WAIT_VIDEO

    data["video_file_id"] = file_id

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Å–ø–∏–∫–µ—Ä–∞ –ø–æ –Ω–æ–≤–æ–º—É —Ç–µ—Å—Ç—É (20 –≤–æ–ø—Ä–æ—Å–æ–≤)
    speaker_type, scales = detect_speaker_type_by_test(data)
    data["speaker_type"] = speaker_type.value
    data["scales"] = scales

    name = get_user_name(update, context)
    name_part = f"{name}, " if name else ""

    # –°–æ–æ–±—â–µ–Ω–∏–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–∏–¥–µ–æ
    await message.reply_text(
        f"{name_part}–≤–∏–¥–µ–æ –ø–æ–ª—É—á–∏–ª üëå\n"
        "–°–º–∏—Ç –ø–æ—Å–º–æ—Ç—Ä–∏—Ç —Ç–≤–æ—ë –≤–∏–¥–µ–æ –∏ —Å–¥–µ–ª–∞–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –≤ —Ç–µ—á–µ–Ω–∏–µ 2-—Ö —á–∞—Å–æ–≤.\n\n"
        "–°–µ–π—á–∞—Å –ø–æ–∫–∞–∂—É –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ —Ç–≤–æ–∏–º –æ—Ç–≤–µ—Ç–∞–º –∏ —Ç–æ–º—É, "
        "–∫–∞–∫ —Ç—ã –æ–±—ã—á–Ω–æ –æ—â—É—â–∞–µ—à—å —Å–≤–æ—é —Ä–µ—á—å."
    )

    # –ù–µ–±–æ–ª—å—à–æ–π –ø—Ä–æ–≥—Ä–µ–≤ –ø–µ—Ä–µ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
    await message.reply_text(
        "–ê –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–±–æ—Ä–∞ —è –¥–∞–º —Ç–µ–±–µ 2‚Äì3 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, "
        "—á—Ç–æ –¥–æ–∫—Ä—É—Ç–∏—Ç—å –≤ —Ä–µ—á–∏ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –ø–æ–¥ —Ç–≤–æ—é —Å–∏—Ç—É–∞—Ü–∏—é."
    )

    # –ó–∞–¥–µ—Ä–∂–∫–∞ 15 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
    await asyncio.sleep(15)

    # –í—ã–≤–æ–¥–∏–º –±–ª–æ–∫ –ø–æ —Ç–∏–ø—É
    if speaker_type == SpeakerType.SISTEM_LIDER:
        await send_result_sistem_lider(update, context)
    elif speaker_type == SpeakerType.POTOK_KHAOS:
        await send_result_potok_khaos(update, context)
    elif speaker_type == SpeakerType.SUKHOY_EKSPERT:
        await send_result_sukhoy_ekspert(update, context)
    elif speaker_type == SpeakerType.HARIZ_KHAOS:
        await send_result_hariz_khaos(update, context)
    elif speaker_type == SpeakerType.STABIL_REMESL:
        await send_result_stabil_remesl(update, context)
    else:  # SpeakerType.ZAZH_VYZH
        await send_result_zazh_vyzh(update, context)

    # –ü—Ä–æ—Å–∏–º —Ç–µ–ª–µ—Ñ–æ–Ω + –¥–∞—ë–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞"
    await message.reply_text(
        "–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –ø—Ä–æ–∫–∞—á–∞—Ç—å —Ä–µ—á—å –Ω–∞ –∫—É—Ä—Å–µ ¬´–ì–æ–≤–æ—Ä–∏ –∏ –£–±–µ–∂–¥–∞–π¬ª, "
        "–Ω–∞–ø–∏—à–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤–æ–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–≤ —Ñ–æ—Ä–º–∞—Ç–µ +7...).\n\n"
        "–ò–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Å—è –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ üëá",
        reply_markup=phone_keyboard(),
    )
    return States.ASK_PHONE


# ---------- –ë–õ–û–ö–ò –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –ü–û –¢–ò–ü–ê–ú ----------

async def send_result_zazh_vyzh(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    –ó–∞–∂–∞—Ç—ã–π –≤—ã–∂–∏–≤–∞–ª—å—â–∏–∫
    """
    name = get_user_name(update, context)
    name_part = f"{name}, " if name else ""

    await update.message.reply_text(
        "–¢–í–û–ô –†–ï–ó–£–õ–¨–¢–ê–¢ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò –†–ï–ß–ò üéô\n\n"
        f"{name_part}—Å–µ–π—á–∞—Å —Ç—ã –±–ª–∏–∂–µ –∫ —Ç–∏–ø—É ¬´–ó–∞–∂–∞—Ç—ã–π –≤—ã–∂–∏–≤–∞–ª—å—â–∏–∫¬ª.\n\n"
        "–ü–æ —Ç–µ—Å—Ç—É –≤–∏–¥–Ω–æ –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è, –∑–∞–∂–∏–º –≤ —Ç–µ–ª–µ –∏ –≥–æ–ª–æ—Å–µ. "
        "–ë–æ–ª—å—à–∞—è —á–∞—Å—Ç—å —ç–Ω–µ—Ä–≥–∏–∏ —É—Ö–æ–¥–∏—Ç –Ω–µ –≤ —Å–º—ã—Å–ª –∏ –≤–ª–∏—è–Ω–∏–µ, –∞ –≤ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–æ—Å—Ç–æ ¬´–≤—ã–∂–∏—Ç—å¬ª "
        "–≤ –º–æ–º–µ–Ω—Ç–µ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç—å –≤—Å–ª—É—Ö."
    )

    await update.message.reply_text(
        "–ö–∞–∫ —ç—Ç–æ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è:\n"
        "‚Ä¢ –ß–∞—Å—Ç–æ —Ö–æ—á–µ—Ç—Å—è –∏–∑–±–µ–∂–∞—Ç—å —Å–∏—Ç—É–∞—Ü–∏–π, –≥–¥–µ –Ω—É–∂–Ω–æ –≤—ã—Å—Ç—É–ø–∞—Ç—å –∏–ª–∏ –≥–æ–≤–æ—Ä–∏—Ç—å –ø—Ä–∏ –¥—Ä—É–≥–∏—Ö.\n"
        "‚Ä¢ –ü–µ—Ä–µ–¥ —Ä–µ—á—å—é —Ç–µ–ª–æ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç: —Å–µ—Ä–¥—Ü–µ, –¥—ã—Ö–∞–Ω–∏–µ, –∑–∞–∂–∏–º—ã, ¬´–∫–æ–º –≤ –≥–æ—Ä–ª–µ¬ª.\n"
        "‚Ä¢ –ú—ã—Å–ª—å —Ä—É—à–∏—Ç—Å—è –∏–º–µ–Ω–Ω–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –Ω–∞ —Ç–µ–±—è —Å–º–æ—Ç—Ä—è—Ç.\n"
        "‚Ä¢ –ì–æ–ª–æ—Å –∑–≤—É—á–∏—Ç —Ç–∏—à–µ –∏ —Å–ª–∞–±–µ–µ, —á–µ–º —Ç—ã –µ—Å—Ç—å –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ.\n\n"
        "–í–∞–∂–Ω–æ: —ç—Ç–æ –Ω–µ ¬´—Ç—ã —Ç–∞–∫–æ–π —á–µ–ª–æ–≤–µ–∫¬ª, —ç—Ç–æ –ø—Ä–∏–≤—ã—á–Ω—ã–µ —Ä–µ–∞–∫—Ü–∏–∏ –∏ –Ω–µ–æ—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –Ω–∞–≤—ã–∫–∏.\n\n"
        "–¢–≤–æ—è –ø–µ—Ä–≤–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–µ —Å—Ç—Ä–æ–∏—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–µ —Ä–µ—á–∏, –∞ —Å–æ–∑–¥–∞—Ç—å —Å–µ–±–µ –æ–ø–æ—Ä—É:\n"
        "‚Äî —Å–Ω—è—Ç—å –±–∞–∑–æ–≤—ã–π —Å—Ç—Ä–∞—Ö –æ—Ü–µ–Ω–∫–∏,\n"
        "‚Äî —Ä–∞—Å–∫—Ä–µ–ø–æ—Å—Ç–∏—Ç—å —Ç–µ–ª–æ –∏ –≥–æ–ª–æ—Å,\n"
        "‚Äî –Ω–∞—É—á–∏—Ç—å—Å—è —Å–ø–æ–∫–æ–π–Ω–æ –≤—ã–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –ª—é–¥–µ–π.\n\n"
        "–≠—Ç–æ–º—É –º—ã –º–Ω–æ–≥–æ —É–¥–µ–ª—è–µ–º –≤–Ω–∏–º–∞–Ω–∏—è –Ω–∞ –∫—É—Ä—Å–µ ¬´–ì–æ–≤–æ—Ä–∏ –∏ –£–±–µ–∂–¥–∞–π¬ª: —á–µ—Ä–µ–∑ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è, "
        "–≤–∏–¥–µ–æ–æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É—Å–ª–æ–∂–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á. –ö–æ–≥–¥–∞ —É—Ö–æ–¥–∏—Ç —Ä–µ–∂–∏–º ¬´–≤—ã–∂–∏–≤–∞–Ω–∏—è¬ª, "
        "–Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –≤—ã—Ö–æ–¥–∏—Ç —Ç–≤–æ—è –Ω–∞—Å—Ç–æ—è—â–∞—è —Å–∏–ª–∞ –∏ —Ö–∞—Ä–∏–∑–º–∞."
    )


async def send_result_potok_khaos(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    –ü–æ—Ç–æ–∫–æ–≤—ã–π —Ö–∞–æ—Ç–∏–∫
    """
    name = get_user_name(update, context)
    name_part = f"{name}, " if name else ""

    await update.message.reply_text(
        "–¢–í–û–ô –†–ï–ó–£–õ–¨–¢–ê–¢ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò –†–ï–ß–ò üéô\n\n"
        f"{name_part}—Ç—ã –±–ª–∏–∑–æ–∫ –∫ —Ç–∏–ø—É ¬´–ü–æ—Ç–æ–∫–æ–≤—ã–π —Ö–∞–æ—Ç–∏–∫¬ª.\n\n"
        "–ü–æ —Ç–µ—Å—Ç—É –≤–∏–¥–Ω–æ: —É —Ç–µ–±—è –µ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏—è, –∏–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏—è –∏ –∂–∏–≤–æ—Å—Ç—å. "
        "–¢—ã –º–æ–∂–µ—à—å –≥–æ–≤–æ—Ä–∏—Ç—å –º–Ω–æ–≥–æ –∏ –¥–æ–ª–≥–æ, –Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –∑–∞ –ø–æ—Ç–æ–∫–æ–º ‚Äî "
        "–∏ —á–∞—Å—Ç—å —Å–º—ã—Å–ª–∞ —Ç–µ—Ä—è–µ—Ç—Å—è –ø–æ –¥–æ—Ä–æ–≥–µ."
    )

    await update.message.reply_text(
        "–ö–∞–∫ —ç—Ç–æ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è:\n"
        "‚Ä¢ –õ–µ–≥–∫–æ –≤—Ö–æ–¥–∏—à—å –≤ —Ä–µ—á—å, –Ω–æ —á–∞—Å—Ç–æ –ø—Ä—ã–≥–∞–µ—à—å —Å —Ç–µ–º—ã –Ω–∞ —Ç–µ–º—É.\n"
        "‚Ä¢ –¢–µ–º–ø –≤—ã—Å–æ–∫–∏–π, –º–∞–ª–æ –ø–∞—É–∑ ‚Äî —Å–ª—É—à–∞—Ç–µ–ª—é —Ç—è–∂–µ–ª–æ —É—Å–ø–µ–≤–∞—Ç—å –∑–∞ –º—ã—Å–ª—å—é.\n"
        "‚Ä¢ –ì–ª–∞–≤–Ω–∞—è –∏–¥–µ—è –∏–Ω–æ–≥–¥–∞ —Ç–æ–Ω–µ—Ç –≤ –¥–µ—Ç–∞–ª—è—Ö, —Ñ–∏–Ω–∞–ª –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Ä–∞–∑–º—ã—Ç—ã–º.\n"
        "‚Ä¢ –õ—é–¥–∏ –º–æ–≥—É—Ç –≥–æ–≤–æ—Ä–∏—Ç—å: ¬´–ö–ª–∞—Å—Å–Ω–æ, –Ω–æ –Ω–µ–º–Ω–æ–≥–æ —Å—É–º–±—É—Ä–Ω–æ¬ª.\n\n"
        "–¢–µ–±–µ –Ω–µ –Ω—É–∂–Ω–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è —Ç–∏—Ö–∏–º –∏ ¬´–ø–∞—Ñ–æ—Å–Ω—ã–º¬ª ‚Äî —Ç–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è —ç—Ç–æ –ø–ª—é—Å, –∞ –Ω–µ –º–∏–Ω—É—Å.\n\n"
        "–ó–∞–¥–∞—á–∞ ‚Äî —É–ø–∞–∫–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫ –≤ —Ä–µ–ª—å—Å—ã:\n"
        "‚Äî —á—ë—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: –Ω–∞—á–∞–ª–æ‚Äì—Å–µ—Ä–µ–¥–∏–Ω–∞‚Äì—Ñ–∏–Ω–∞–ª,\n"
        "‚Äî –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–µ –ø–∞—É–∑—ã,\n"
        "‚Äî –∞–∫—Ü–µ–Ω—Ç—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π –º—ã—Å–ª–∏, –∞ –Ω–µ –Ω–∞ —Ö–∞–æ—Å–µ –¥–µ—Ç–∞–ª–µ–π.\n\n"
        "–ù–∞ ¬´–ì–æ–≤–æ—Ä–∏ –∏ –£–±–µ–∂–¥–∞–π¬ª –º—ã –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–≤–æ—é –∂–∏–≤–æ—Å—Ç—å, –Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä–∫–∞—Å: "
        "—Ç—ã —É—á–∏—à—å—Å—è –≥–æ–≤–æ—Ä–∏—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –∏ —ç–Ω–µ—Ä–≥–∏—è —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞—Å—å, –∏ –º—ã—Å–ª—å –±—ã–ª–∞ –ø–æ–Ω—è—Ç–Ω–∞ "
        "–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–ø–ª—è–ª–∞ –ª—é–¥–µ–π."
    )


async def send_result_sukhoy_ekspert(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    –°—É—Ö–æ–π —ç–∫—Å–ø–µ—Ä—Ç
    """
    name = get_user_name(update, context)
    name_part = f"{name}, " if name else ""

    await update.message.reply_text(
        "–¢–í–û–ô –†–ï–ó–£–õ–¨–¢–ê–¢ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò –†–ï–ß–ò üéô\n\n"
        f"{name_part}—Ç—ã –±–ª–∏–∂–µ –∫ —Ç–∏–ø—É ¬´–°—É—Ö–æ–π —ç–∫—Å–ø–µ—Ä—Ç¬ª.\n\n"
        "–ü–æ —Ç–µ—Å—Ç—É –≤–∏–¥–Ω–æ: —É —Ç–µ–±—è –µ—Å—Ç—å —Å–º—ã—Å–ª, –ª–æ–≥–∏–∫–∞ –∏ —á–∞—Å—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞. "
        "–ù–æ –≤ —Ä–µ—á–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –∂–∏–≤–æ—Å—Ç–∏, –æ–±—Ä–∞–∑–æ–≤ –∏ —ç–º–æ—Ü–∏–π, –∏–∑-–∑–∞ —ç—Ç–æ–≥–æ –ª—é–¥—è–º —Å–ª–æ–∂–Ω–æ "
        "–æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —Å —Ç–æ–±–æ–π –¥–æ –∫–æ–Ω—Ü–∞."
    )

    await update.message.reply_text(
        "–ö–∞–∫ —ç—Ç–æ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è:\n"
        "‚Ä¢ –ß–∞—Å—Ç–æ –¥–∞—ë—à—å —Ñ–∞–∫—Ç—ã, —Ü–∏—Ñ—Ä—ã, –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –Ω–æ –º–∞–ª–æ –∏—Å—Ç–æ—Ä–∏–π –∏ –ø—Ä–∏–º–µ—Ä–æ–≤.\n"
        "‚Ä¢ –ú–æ–∂–µ—à—å –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–µ–π ‚Äî –≥–æ–ª–æ–≤–∞ –ø–æ–Ω–∏–º–∞–µ—Ç, —Å–µ—Ä–¥—Ü–µ —Å–ø–∏—Ç.\n"
        "‚Ä¢ –ì–æ–ª–æ—Å –∏ –Ω–µ–≤–µ—Ä–±–∞–ª–∏–∫–∞ –∑–≤—É—á–∞—Ç –æ–¥–Ω–æ—Ç–æ–Ω–Ω–æ, –±–µ–∑ —è—Ä–∫–∏—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏ ¬´–∫—Ä—é—á–∫–æ–≤¬ª.\n"
        "‚Ä¢ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å: ¬´–í —Ü–µ–ª–æ–º –≤—Å—ë –≤–µ—Ä–Ω–æ, –Ω–æ –Ω–µ–º–Ω–æ–≥–æ —Å–∫—É—á–Ω–æ/—Ç—è–∂–µ–ª–æ–≤–∞—Ç–æ —Å–ª—É—à–∞—Ç—å¬ª.\n\n"
        "–¢—ã —É–∂–µ –ø—Ä–æ–¥–µ–ª–∞–ª(–∞) –ø–æ–ª–æ–≤–∏–Ω—É –ø—É—Ç–∏: —É —Ç–µ–±—è –µ—Å—Ç—å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ.\n"
        "–í—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ ‚Äî —É–ø–∞–∫–æ–≤–∫–∞:\n"
        "‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏–∏, –º–µ—Ç–∞—Ñ–æ—Ä—ã, –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –∂–∏–∑–Ω–∏,\n"
        "‚Äî –Ω–∞—É—á–∏—Ç—å—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å –≥–æ–ª–æ—Å–æ–º –∏ –ø–∞—É–∑–∞–º–∏,\n"
        "‚Äî –≤–∫–ª—é—á–∏—Ç—å —ç–º–æ—Ü–∏—é –∏ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π —è–∑—ã–∫ –≤–º–µ—Å—Ç–æ ¬´—Å—É—Ö–æ–≥–æ –¥–æ–∫–ª–∞–¥–∞¬ª.\n\n"
        "–ù–∞ ¬´–ì–æ–≤–æ—Ä–∏ –∏ –£–±–µ–∂–¥–∞–π¬ª –º—ã –±–µ—Ä—ë–º —Ç–∞–∫–∏—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –∏ –¥–µ–ª–∞–µ–º —Ç–∞–∫, —á—Ç–æ–±—ã –ª—é–¥–∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ "
        "—Å–æ–≥–ª–∞—à–∞–ª–∏—Å—å, –∞ –∂–¥–∞–ª–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–π –∏ —Å–∞–º–∏ –ø—Ä–æ—Å–∏–ª–∏: ¬´–†–∞—Å—Å–∫–∞–∂–∏ –µ—â—ë¬ª."
    )


async def send_result_hariz_khaos(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    –•–∞—Ä–∏–∑–º–∞—Ç–∏—á–Ω—ã–π —Ö–∞–æ—Å
    """
    name = get_user_name(update, context)
    name_part = f"{name}, " if name else ""

    await update.message.reply_text(
        "–¢–í–û–ô –†–ï–ó–£–õ–¨–¢–ê–¢ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò –†–ï–ß–ò üéô\n\n"
        f"{name_part}—Ç—ã –±–ª–∏–∂–µ –∫ —Ç–∏–ø—É ¬´–•–∞—Ä–∏–∑–º–∞—Ç–∏—á–Ω—ã–π —Ö–∞–æ—Å¬ª.\n\n"
        "–ü–æ —Ç–µ—Å—Ç—É –≤–∏–¥–Ω–æ: —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ —Å–ª—É—à–∞—Ç—å ‚Äî –µ—Å—Ç—å –∂–∏–≤–æ–π –≥–æ–ª–æ—Å, —ç–º–æ—Ü–∏–∏, –º–∏–º–∏–∫–∞. "
        "–ù–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –ø–æ–Ω—è—Ç–Ω–æ, –∫ –∫–∞–∫–æ–º—É –≤—ã–≤–æ–¥—É —Ç—ã –≤–µ–¥—ë—à—å –ª—é–¥–µ–π –∏ —á—Ç–æ –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã —Å–¥–µ–ª–∞—Ç—å "
        "–ø–æ—Å–ª–µ —Ç–≤–æ–µ–π —Ä–µ—á–∏."
    )

    await update.message.reply_text(
        "–ö–∞–∫ —ç—Ç–æ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è:\n"
        "‚Ä¢ –¢—ã –ª–µ–≥–∫–æ —Ü–µ–ø–ª—è–µ—à—å –≤–Ω–∏–º–∞–Ω–∏–µ –≤ –Ω–∞—á–∞–ª–µ, –ª—é–¥–∏ —Ä–µ–∞–≥–∏—Ä—É—é—Ç –∏ –≤–∫–ª—é—á–∞—é—Ç—Å—è.\n"
        "‚Ä¢ –ü–æ —Ö–æ–¥—É –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑–º—ã–≤–∞–µ—Ç—Å—è, –∏–¥–µ–∏ –Ω–∞—á–∏–Ω–∞—é—Ç –∫—Ä—É–∂–∏—Ç—å –≤–æ–∫—Ä—É–≥ —Ç–µ–º—ã.\n"
        "‚Ä¢ –ò–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏—è —Å–∏–ª—å–Ω–∞—è, –Ω–æ –º–æ–∂–Ω–æ —É–≤–ª–µ—á—å—Å—è –∏ –∑–∞–±—ã—Ç—å –ø—Ä–æ —Ü–µ–ª—å —Ä–µ—á–∏.\n"
        "‚Ä¢ –ü–æ—Å–ª–µ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è –ª—é–¥–∏ –∏–Ω–æ–≥–¥–∞ –Ω–µ –¥–æ –∫–æ–Ω—Ü–∞ –ø–æ–Ω–∏–º–∞—é—Ç, –∫ —á–µ–º—É –≤—Å—ë —ç—Ç–æ –≤–µ–ª–æ.\n\n"
        "–¢–≤–æ—é —Ö–∞—Ä–∏–∑–º—É –Ω–µ –Ω—É–∂–Ω–æ —á–∏–Ω–∏—Ç—å –∏–ª–∏ –≥–∞—Å–∏—Ç—å ‚Äî –µ—ë –Ω—É–∂–Ω–æ –ø–æ—Å–∞–¥–∏—Ç—å –Ω–∞ —á—ë—Ç–∫–∏–π —Å—Ç–µ—Ä–∂–µ–Ω—å:\n"
        "‚Äî —è—Å–Ω–æ–µ –Ω–∞—á–∞–ª–æ: –∑–∞—á–µ–º –º—ã –∑–¥–µ—Å—å –∏ –æ —á—ë–º —Ç—ã,\n"
        "‚Äî –ª–æ–≥–∏—á–Ω–∞—è —Å–µ—Ä–µ–¥–∏–Ω–∞: 2‚Äì3 –æ–ø–æ—Ä–Ω—ã–µ –º—ã—Å–ª–∏,\n"
        "‚Äî —Å–∏–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–ª: –≤—ã–≤–æ–¥, –¥–µ–π—Å—Ç–≤–∏–µ, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.\n\n"
        "–ù–∞ ¬´–ì–æ–≤–æ—Ä–∏ –∏ –£–±–µ–∂–¥–∞–π¬ª —è –¥–∞—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, —á—Ç–æ–±—ã —Ç–≤–æ—è —Ö–∞—Ä–∏–∑–º–∞ –Ω–µ —Ä–∞—Å—Å—ã–ø–∞–ª–∞—Å—å, "
        "–∞ –±–∏–ª–∞ –≤ —Ü–µ–ª—å: –ø–æ—Å–ª–µ —Ç–≤–æ–µ–π —Ä–µ—á–∏ –ª—é–¥—è–º –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –¥–µ–ª–∞—Ç—å –∏ –ø–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ."
    )


async def send_result_stabil_remesl(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    –°—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–º–µ—Å–ª–µ–Ω–Ω–∏–∫
    """
    name = get_user_name(update, context)
    name_part = f"{name}, " if name else ""

    await update.message.reply_text(
        "–¢–í–û–ô –†–ï–ó–£–õ–¨–¢–ê–¢ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò –†–ï–ß–ò üéô\n\n"
        f"{name_part}—Ç—ã –±–ª–∏–∂–µ –∫ —Ç–∏–ø—É ¬´–°—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–º–µ—Å–ª–µ–Ω–Ω–∏–∫¬ª.\n\n"
        "–ü–æ —Ç–µ—Å—Ç—É –≤–∏–¥–Ω–æ: —Ç—ã —É–∂–µ –≥–æ–≤–æ—Ä–∏—à—å –Ω–∞ —É—Ä–æ–≤–Ω–µ ¬´–Ω–æ—Ä–º¬ª. –ë–µ–∑ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ, –±–µ–∑ –ø—Ä–æ–≤–∞–ª–æ–≤, "
        "—Ç–µ–±—è –º–æ–∂–Ω–æ —Å–ª—É—à–∞—Ç—å. –ù–æ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è, –∫–æ–≥–¥–∞ —Ç–µ–±—è —Ö–æ—Ç—è—Ç —Å–ª—É—à–∞—Ç—å –∏ "
        "–∑–∞–ø–æ–º–∏–Ω–∞—é—Ç –Ω–∞–¥–æ–ª–≥–æ."
    )

    await update.message.reply_text(
        "–ö–∞–∫ —ç—Ç–æ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è:\n"
        "‚Ä¢ –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–∏—Ç—É–∞—Ü–∏–π —Ç—ã —Å–ø—Ä–∞–≤–ª—è–µ—à—å—Å—è: –º—ã—Å–ª—å –¥–æ–Ω—ë—Å(–ª–∞), –¥–∏–∞–ª–æ–≥ –Ω–µ —Å–æ—Ä–≤–∞–ª(–∞).\n"
        "‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –≥–æ–ª–æ—Å –∏–Ω–æ–≥–¥–∞ –µ—Å—Ç—å, –∏–Ω–æ–≥–¥–∞ ¬´–≥—É–ª—è—é—Ç¬ª, –Ω–æ –±–µ–∑ –∂—ë—Å—Ç–∫–∏—Ö –∑–∞–≤–∞–ª–æ–≤.\n"
        "‚Ä¢ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å: ¬´–í—Å—ë –Ω–æ—Ä–º–∞–ª—å–Ω–æ¬ª, ¬´–∞–¥–µ–∫–≤–∞—Ç–Ω–æ¬ª, ¬´–Ω–∏—á–µ–≥–æ –ª–∏—à–Ω–µ–≥–æ¬ª, –Ω–æ –±–µ–∑ ¬´–≤–∞—É¬ª.\n"
        "‚Ä¢ –í–Ω—É—Ç—Ä–∏ –µ—Å—Ç—å –æ—â—É—â–µ–Ω–∏–µ, —á—Ç–æ –º–æ–∂–µ—à—å –≥–æ–≤–æ—Ä–∏—Ç—å —Å–∏–ª—å–Ω–µ–µ, —á–µ–º —Å–µ–π—á–∞—Å.\n\n"
        "–¢—ã —É–∂–µ –≤—ã—à–µ–ª(–ª–∞) –∏–∑ –∑–æ–Ω—ã ¬´—Å—Ç—Ä–∞—Ö–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞¬ª ‚Äî —ç—Ç–æ —Å–∏–ª—å–Ω–∞—è –±–∞–∑–∞.\n"
        "–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî –ø–µ—Ä–µ–π—Ç–∏ –∏–∑ —Ä–µ–º–µ—Å–ª–∞ –≤ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ:\n"
        "‚Äî –¥–æ–∫—Ä—É—Ç–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–∫, —á—Ç–æ–±—ã —Ç–µ–±—è —Å–ª—É—à–∞–ª–∏ –ª–µ–≥–∫–æ –∏ –¥–æ –∫–æ–Ω—Ü–∞,\n"
        "‚Äî –ø—Ä–æ–∫–∞—á–∞—Ç—å –≥–æ–ª–æ—Å –∏ –ø–æ–¥–∞—á—É, —á—Ç–æ–±—ã —Ä–µ—á—å –∑–≤—É—á–∞–ª–∞ –æ–±—ä—ë–º–Ω–æ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ,\n"
        "‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏–∏, —ç–º–æ—Ü–∏—é –∏ —Ä–∞–±–æ—Ç—É —Å –≤–Ω–∏–º–∞–Ω–∏–µ–º.\n\n"
        "–ö—É—Ä—Å ¬´–ì–æ–≤–æ—Ä–∏ –∏ –£–±–µ–∂–¥–∞–π¬ª –∫–∞–∫ —Ä–∞–∑ –ø—Ä–æ —ç—Ç–æ—Ç —Å–∫–∞—á–æ–∫: —Å —Ç–≤–æ–µ–≥–æ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è "
        "–≤ —Å—Ç–æ—Ä–æ–Ω—É —Å–∏–ª—å–Ω–æ–≥–æ, –∑—Ä–µ–ª–æ–≥–æ —Å–ø–∏–∫–µ—Ä–∞, –∫–æ—Ç–æ—Ä–æ–º—É –¥–æ–≤–µ—Ä—è—é—Ç –∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–ø–æ–º–∏–Ω–∞—é—Ç."
    )


async def send_result_sistem_lider(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    –°–∏—Å—Ç–µ–º–Ω—ã–π –ª–∏–¥–µ—Ä
    """
    name = get_user_name(update, context)
    name_part = f"{name}, " if name else ""

    await update.message.reply_text(
        "–¢–í–û–ô –†–ï–ó–£–õ–¨–¢–ê–¢ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò –†–ï–ß–ò üéô\n\n"
        f"{name_part}—Ç—ã —É–∂–µ –±–ª–∏–∑–æ–∫ –∫ —É—Ä–æ–≤–Ω—é ¬´–°–∏—Å—Ç–µ–º–Ω—ã–π –ª–∏–¥–µ—Ä¬ª.\n\n"
        "–ü–æ —Ç–µ—Å—Ç—É –≤–∏–¥–Ω–æ: —É —Ç–µ–±—è —Å–∏–ª—å–Ω–∞—è –±–∞–∑–∞ ‚Äî —Ç—ã –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—à—å —Å—Ç—Ä–µ—Å—Å, –¥–µ—Ä–∂–∏—à—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É, "
        "—É–º–µ–µ—à—å —Ä–∞–±–æ—Ç–∞—Ç—å –≥–æ–ª–æ—Å–æ–º, –Ω–µ —Ç–µ—Ä—è–µ—à—å—Å—è –≤ –∏–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏–∏ –∏ –≤–ª–∏—è–µ—à—å –Ω–∞ –ª—é–¥–µ–π —á–µ—Ä–µ–∑ —Ä–µ—á—å."
    )

    await update.message.reply_text(
        "–ö–∞–∫ —ç—Ç–æ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è:\n"
        "‚Ä¢ –¢—ã —Å–ø–æ–∫–æ–π–Ω–æ –≤—ã—Å—Ç—É–ø–∞–µ—à—å –ø–µ—Ä–µ–¥ —Ä–∞–∑–Ω—ã–º–∏ –∞—É–¥–∏—Ç–æ—Ä–∏—è–º–∏ –∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—à—å—Å—è –ø–æ–¥ —Å–∏—Ç—É–∞—Ü–∏—é.\n"
        "‚Ä¢ –õ—é–¥–∏ —á–∞—Å—Ç–æ –≥–æ–≤–æ—Ä—è—Ç: ¬´–∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ¬ª, ¬´–ø–æ –¥–µ–ª—É¬ª, ¬´—É–±–µ–¥–∏—Ç–µ–ª—å–Ω–æ¬ª, ¬´—Ç–µ–±—è —Ö–æ—á–µ—Ç—Å—è —Å–ª—É—à–∞—Ç—å¬ª.\n"
        "‚Ä¢ –¢—ã —É–∂–µ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ –≤–∫–ª–∞–¥—ã–≤–∞–µ—à—å—Å—è –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ —Ä–µ—á–∏ –∏ –ø–æ–Ω–∏–º–∞–µ—à—å –µ—ë –≤–ª–∏—è–Ω–∏–µ "
        "–Ω–∞ –∫–∞—Ä—å–µ—Ä—É, –¥–µ–Ω—å–≥–∏ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ.\n"
        "‚Ä¢ –¢–µ–±–µ —Å–∫–æ—Ä–µ–µ —Ö–æ—á–µ—Ç—Å—è –Ω–µ —É–±—Ä–∞—Ç—å —Å—Ç—Ä–∞—Ö, –∞ —É—Å–∏–ª–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ –∏ –º–∞—Å—à—Ç–∞–±.\n\n"
        "–ù–∞ —Ç–≤–æ—ë–º —É—Ä–æ–≤–Ω–µ –∑–∞–¥–∞—á–∞ —É–∂–µ –Ω–µ —á–∏–Ω–∏—Ç—å –æ—à–∏–±–∫–∏, –∞ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ç–æ–Ω–∫—É—é –æ–ø—Ç–∏–∫—É:\n"
        "‚Äî —É—Å–∏–ª–∏–≤–∞—Ç—å —Å—Ç–æ—Ä–∏—Ç–µ–ª–ª–∏–Ω–≥ –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –≥–ª—É–±–∏–Ω—É,\n"
        "‚Äî —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫—Ä—É–ø–Ω—ã–º–∏ –∞—É–¥–∏—Ç–æ—Ä–∏—è–º–∏ –∏ —Å—Ç–∞—Ç—É—Å–æ–º,\n"
        "‚Äî –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ª–∏—á–Ω—ã–π –±—Ä–µ–Ω–¥ —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–µ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è.\n\n"
        "–ù–∞ ¬´–ì–æ–≤–æ—Ä–∏ –∏ –£–±–µ–∂–¥–∞–π¬ª —è –ø–æ–º–æ–≥–∞—é —Ç–∞–∫–∏–º —Å–ø–∏–∫–µ—Ä–∞–º –ø–µ—Ä–µ–π—Ç–∏ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è "
        "¬´—è —Ö–æ—Ä–æ—à–æ –≥–æ–≤–æ—Ä—é¬ª –≤ —Ä–µ–∂–∏–º ¬´–º–µ–Ω—è —Ü–∏—Ç–∏—Ä—É—é—Ç, –º–Ω–µ –¥–æ–≤–µ—Ä—è—é—Ç, –∏ –º–æ–∏ —Å–ª–æ–≤–∞ –¥–≤–∏–≥–∞—é—Ç "
        "–ø—Ä–æ–µ–∫—Ç—ã, –ª—é–¥–µ–π –∏ –¥–µ–Ω—å–≥–∏¬ª."
    )


# ---------- –°–û–•–†–ê–ù–ï–ù–ò–ï –¢–ï–õ–ï–§–û–ù–ê + –ó–ê–Ø–í–ö–ê –ê–î–ú–ò–ù–£ ----------

async def save_phone(update: Update, context: ContextTypes.DEFAULT_TYPE):
    data = get_user_data(context)

    phone = None
    text = update.message.text or ""

    # 1. –ï—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ –Ω–∞–∂–∞–ª "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç"
    if update.message.contact:
        phone = update.message.contact.phone_number

    # 2. –ï—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ –Ω–∞–∂–∞–ª "–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞"
    elif text == COURSE_BUTTON_TEXT:
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —Å–∞–π—Ç
        await update.message.reply_text(
            f"–í–æ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞ ¬´–ì–æ–≤–æ—Ä–∏ –∏ –£–±–µ–∂–¥–∞–π¬ª:\n{COURSE_URL}\n\n"
            "–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É, –Ω–∞–ø–∏—à–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–≤ —Ñ–æ—Ä–º–∞—Ç–µ +7...) "
            "–∏–ª–∏ –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá",
            reply_markup=phone_keyboard(),
        )
        # –û—Å—Ç–∞—ë–º—Å—è –≤ —ç—Ç–æ–º –∂–µ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ ‚Äî –∂–¥—ë–º —Ç–µ–ª–µ—Ñ–æ–Ω
        return States.ASK_PHONE

    # 3. –ò–Ω–∞—á–µ —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ —ç—Ç–æ –≤–≤–µ–¥—ë–Ω–Ω—ã–π —Ä—É–∫–∞–º–∏ –Ω–æ–º–µ—Ä
    else:
        phone = text

    data["phone"] = phone

    name = get_user_name(update, context)
    name_part = f"{name}, " if name else ""

    await update.message.reply_text(
        f"{name_part}—Å–ø–∞—Å–∏–±–æ! üôå\n"
        "–Ø –ø–æ–ª—É—á–∏–ª —Ç–≤–æ—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –∏ –∫–æ–Ω—Ç–∞–∫—Ç.\n"
        "–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å —Ç–æ–±–æ–π –∏ —Ä–∞—Å—Å–∫–∞–∂–µ–º, –∫–∞–∫ –ø–æ–ø–∞—Å—Ç—å –Ω–∞ –∫—É—Ä—Å ¬´–ì–æ–≤–æ—Ä–∏ –∏ –£–±–µ–∂–¥–∞–π¬ª.",
        reply_markup=ReplyKeyboardRemove(),
    )

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω—É, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω ADMIN_CHAT_ID
    if ADMIN_CHAT_ID:
        try:
            user = update.effective_user

            # 1. –¢–µ–∫—Å—Ç–æ–≤–∞—è —Å–≤–æ–¥–∫–∞
            summary_lines = []
            summary_lines.append("–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ üéô")
            summary_lines.append(f"–ò–º—è –≤ —á–∞—Ç–µ: {user.full_name}")
            saved_name = data.get("name")
            if saved_name:
                summary_lines.append(f"–ò–º—è, –≤–≤–µ–¥—ë–Ω–Ω–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º: {saved_name}")
            if user.username:
                summary_lines.append(f"Username: @{user.username}")
            summary_lines.append(f"–¢–µ–ª–µ—Ñ–æ–Ω: {phone}")

            speaker_type = data.get("speaker_type", "–Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω")
            summary_lines.append(f"–¢–∏–ø —Å–ø–∏–∫–µ—Ä–∞ (–ø–æ —Ç–µ—Å—Ç—É): {speaker_type}")

            scales = data.get("scales", {})
            if scales:
                summary_lines.append(
                    "–®–∫–∞–ª—ã A‚ÄìF: " +
                    ", ".join(f"{k}={v:.2f}" for k, v in scales.items())
                )

            for i in range(1, 21):
                qi = data.get(f"q{i}")
                if qi:
                    summary_lines.append(f"q{i}: {qi}")

            text_to_admin = "\n".join(summary_lines)

            await context.bot.send_message(
                chat_id=ADMIN_CHAT_ID,
                text=text_to_admin,
            )

            # 2. –í–∏–¥–µ–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            video_id = data.get("video_file_id")
            video_type = data.get("video_type", "video")
            if video_id:
                if video_type == "video_note":
                    await context.bot.send_video_note(
                        chat_id=ADMIN_CHAT_ID,
                        video_note=video_id,
                    )
                else:
                    await context.bot.send_video(
                        chat_id=ADMIN_CHAT_ID,
                        video=video_id,
                        caption="–í–∏–¥–µ–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ—á–∏ üé•",
                    )

        except Exception:
            logger.exception("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω—É")

    return ConversationHandler.END


async def cancel(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞. –ï—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å –ø—Ä–æ–π—Ç–∏ –µ—ë —Å–Ω–æ–≤–∞ ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ /start.",
        reply_markup=ReplyKeyboardRemove(),
    )
    return ConversationHandler.END


# ---------- MAIN ----------

def main():
    if not BOT_TOKEN:
        raise RuntimeError("–ù–µ –Ω–∞–π–¥–µ–Ω BOT_TOKEN –≤ .env")

    # persistence: —á—Ç–æ–±—ã user_data –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–µ —Ç–µ—Ä—è–ª–∏—Å—å –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
    persistence = PicklePersistence(filepath="bot_data.pkl")

    app = (
        ApplicationBuilder()
        .token(BOT_TOKEN)
        .persistence(persistence)
        .build()
    )

    conv = ConversationHandler(
        entry_points=[CommandHandler("start", start)],
        states={
            States.ASK_NAME: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_name_and_start_test)
            ],
            States.Q1: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q1_and_next)
            ],
            States.Q2: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q2_and_next)
            ],
            States.Q3: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q3_and_next)
            ],
            States.Q4: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q4_and_next)
            ],
            States.Q5: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q5_and_next)
            ],
            States.Q6: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q6_and_next)
            ],
            States.Q7: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q7_and_next)
            ],
            States.Q8: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q8_and_next)
            ],
            States.Q9: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q9_and_next)
            ],
            States.Q10: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q10_and_next)
            ],
            States.Q11: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q11_and_next)
            ],
            States.Q12: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q12_and_next)
            ],
            States.Q13: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q13_and_next)
            ],
            States.Q14: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q14_and_next)
            ],
            States.Q15: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q15_and_next)
            ],
            States.Q16: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q16_and_next)
            ],
            States.Q17: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q17_and_next)
            ],
            States.Q18: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q18_and_next)
            ],
            States.Q19: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q19_and_next)
            ],
            States.Q20: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, save_q20_and_ask_video)
            ],
            States.WAIT_VIDEO: [
                MessageHandler(filters.VIDEO | filters.VIDEO_NOTE, handle_video)
            ],
            States.ASK_PHONE: [
                MessageHandler(
                    (filters.CONTACT | filters.TEXT) & ~filters.COMMAND,
                    save_phone,
                )
            ],
        },
        fallbacks=[CommandHandler("cancel", cancel)],
    )

    app.add_handler(conv)
    app.add_handler(CommandHandler("help", help_cmd))

    app.run_polling()


if __name__ == "__main__":
    # Python 3.14 —Ñ–∏–∫—Å: —è–≤–Ω–æ —Å–æ–∑–¥–∞—ë–º event loop
    loop = asyncio.new_event_loop()
    asyncio.set_event_loop(loop)
    main()
